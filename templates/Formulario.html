<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Protocolo - Entrada de Processo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-image: url("C:\\Users\\gabriel bravo\\Desktop\\sistema_protocolo\\backend\\templates\\img"); /* Use barras duplas para o caminho */
            background-repeat: no-repeat;
            background-size: cover;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .processo {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin-left: 5px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #3498db;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .required label:after {
            content: " *";
            color: #e74c3c;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-col {
            flex: 1;
        }
        .buttons {
            margin-top: 30px;
            text-align: center;
        }
        .botao-processos {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 0 30px 0;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }
        .botao-processos:hover {
            background-color: #2980b9;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 0 10px;
        }
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        input:invalid, select:invalid, textarea:invalid {
            border-color: #e74c3c;
        }
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SISTEMA DE PROTOCOLO</h1>
        <h2>ENTRADA DE PROCESSO</h2>
        <a href="/listar" class="botao-processos">Ver todos os processos cadastrados</a>
        
        <div id="successMessage" class="success-message">
            Processo cadastrado com sucesso!
        </div>
        
        <form id="protocoloForm">
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group required">
                        <label for="numeroProcesso">NÚMERO DE PROCESSO</label>
                        <input type="text" id="numeroProcesso" required>
                        <div class="error" id="numeroProcessoError">Campo obrigatório</div>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group required">
                        <label for="volume">VOLUME</label>
                        <input type="text" id="volume" required> <div class="error" id="volumeError">Campo obrigatório</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group required">
                <label for="secretaria">SECRETARIA</label>
                <select id="secretaria" required>
                    <option value="">Selecione uma secretaria</option>
                    <option value="Administração, Receita e Tributação">Administração, Receita e Tributação</option>
                    <option value="Agricultura, Abastecimento e Pesca">Agricultura, Abastecimento e Pesca</option>
                    <option value="Comunicação Social">Comunicação Social</option>
                    <option value="Desenvolvimento Social">Desenvolvimento Social</option>
                    <option value="Direitos dos Animais">Direitos dos Animais</option>
                    <option value="Educação, Cultura, Inclusão, Ciência e Tecnologia">Educação, Cultura, Inclusão, Ciência e Tecnologia</option>
                    <option value="Esporte, Lazer e Turismo">Esporte, Lazer e Turismo</option>
                    <option value="Finanças">Finanças</option>
                    <option value="Gabinete">Gabinete</option>
                    <option value="Gestão, Inovação e Tecnologia">Gestão, Inovação e Tecnologia</option>
                    <option value="Governança e Sustentabilidade">Governança e Sustentabilidade</option>
                    <option value="Municipal de Infraestrutura">Municipal de Infraestrutura</option>
                    <option value="Meio Ambiente">Meio Ambiente</option>
                    <option value="Mulher">Mulher</option>
                    <option value="Transporte e Serviços Públicos">Transporte e Serviços Públicos</option>
                    <option value="Obras Públicas">Obras Públicas</option>
                    <option value="Planejamento">Planejamento</option>
                    <option value="Relações Institucionais">Relações Institucionais</option>
                    <option value="Saúde">Saúde</option>
                    <option value="Segurança e Ordem Pública">Segurança e Ordem Pública</option>
                    <option value="Transparência e Integridade">Transparência e Integridade</option>
                    <option value="Urbanismo">Urbanismo</option>
                </select>
                <div class="error" id="secretariaError">Campo obrigatório</div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group required">
                        <label for="dataEntrada">DATA DE ENTRADA</label>
                        <input type="date" id="dataEntrada" required>
                        <div class="error" id="dataEntradaError">Campo obrigatório</div>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group required">
                        <label for="horaEntrada">HORA DE ENTRADA</label>
                        <input type="time" id="horaEntrada" required>
                        <div class="error" id="horaEntradaError">Campo obrigatório</div>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="dataSaida">DATA DE SAÍDA</label>
                        <input type="date" id="dataSaida">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="horaSaida">HORA DE SAÍDA</label>
                        <input type="time" id="horaSaida">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="destino">DESTINO</label>
                <input type="text" id="destino">
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group required">
                        <label for="genero">GÊNERO</label>
                        <select id="genero" required>
                            <option value="">Selecione o gênero</option>
                            <option value="MATERIAL">MATERIAL</option>
                            <option value="SERVIÇO">SERVIÇO</option>
                            <option value="OUTROS">OUTROS</option>
                        </select>
                        <div class="error" id="generoError">Campo obrigatório</div>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group required">
                        <label for="especie">ESPÉCIE</label>
                        <select id="especie" required>
                            <option value="">Selecione a espécie</option>
                            <option value="ADIANTAMENTO">ADIANTAMENTO</option>
                            <option value="PAGAMENTO">PAGAMENTO</option>
                            <option value="TERMO ADITIVO">TERMO ADITIVO</option>
                            <option value="ANÁLISE INICIAL">ANÁLISE INICIAL</option>
                            <option value="OUTROS">OUTROS</option>
                        </select>
                        <div class="error" id="especieError">Campo obrigatório</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group required">
                <label for="objeto">OBJETO</label>
                <textarea id="objeto" required></textarea>
                <div class="error" id="objetoError">Campo obrigatório</div>
            </div>
            
            <div class="form-group">
                <label for="contratada">CONTRATADA/INTERESSADA</label>
                <input type="text" id="contratada">
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="recorrente">IDENTIFICAÇÃO SE É RECORRENTE OU NÃO</label>
                        <select id="recorrente">
                            <option value="NÃO">NÃO</option>
                            <option value="SIM">SIM</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group required">
                        <label for="prioridade">GRAU DE PRIORIDADE</label>
                        <select id="prioridade" required>
                            <option value="">Selecione a prioridade</option>
                            <option value="BAIXA">BAIXA</option>
                            <option value="MÉDIA">MÉDIA</option>
                            <option value="ALTA">ALTA</option>
                            <option value="URGENTE">URGENTE</option>
                        </select>
                        <div class="error" id="prioridadeError">Campo obrigatório</div>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="tecnico">TÉCNICO RESPONSÁVEL ANÁLISE</label>
                        <input type="text" id="tecnico">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="dataAnalise">DATA DA ANÁLISE</label>
                        <input type="date" id="dataAnalise">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="numeroDespacho">CONTROLE DO N° DE DESPACHO</label>
                <input type="text" id="numeroDespacho">
            </div>
            
            <div class="form-group">
                <label for="observacao">OBSERVAÇÃO</label>
                <textarea id="observacao"></textarea>
            </div>
            
            <div class="buttons">
                <button type="button" class="btn-secondary" onclick="limparFormulario()">Limpar</button>
                <button type="submit" class="btn-primary">Salvar Processo</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('protocoloForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            
            let isValid = true;
            const requiredFields = [
                'numeroProcesso', 'volume', 'secretaria', 'dataEntrada', 'horaEntrada',
                'genero', 'especie', 'objeto', 'prioridade'
            ];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                const errorElement = document.getElementById(field + 'Error');
                
                if (!element.value.trim()) {
                    element.style.borderColor = '#e74c3c';
                    errorElement.style.display = 'block';
                    isValid = false;
                } else {
                    element.style.borderColor = '#ddd';
                    errorElement.style.display = 'none';
                }
            });
            
            if (!isValid) return;
            
            try {
                
                const formData = {
                    numero_processo: document.getElementById('numeroProcesso').value,
                    volume: document.getElementById('volume').value,
                    secretaria: document.getElementById('secretaria').value,
                    data_entrada: document.getElementById('dataEntrada').value,
                    hora_entrada: document.getElementById('horaEntrada').value,
                    data_saida: document.getElementById('dataSaida').value || null,
                    hora_saida: document.getElementById('horaSaida').value || null,
                    destino: document.getElementById('destino').value || null,
                    genero: document.getElementById('genero').value,
                    especie: document.getElementById('especie').value,
                    objeto: document.getElementById('objeto').value,
                    contratada: document.getElementById('contratada').value || null,
                    recorrente: document.getElementById('recorrente').value || null,
                    prioridade: document.getElementById('prioridade').value,
                    tecnico: document.getElementById('tecnico').value || null,
                    data_analise: document.getElementById('dataAnalise').value || null,
                    numero_despacho: document.getElementById('numeroDespacho').value || null,
                    observacao: document.getElementById('observacao').value || null
                };
                
                
                const response = await fetch('/salvar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('successMessage').style.display = 'block';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    setTimeout(() => {
                        document.getElementById('successMessage').style.display = 'none';
                        limparFormulario();
                    }, 3000);
                } else {
                    alert('Erro ao salvar: ' + result.message);
                }
            } catch (error) {
                alert('Erro na comunicação com o servidor: ' + error.message);
            }
        });

        
        function limparFormulario() {
            document.getElementById('protocoloForm').reset();
           
            const requiredFields = [
                'numeroProcesso', 'volume', 'secretaria', 'dataEntrada', 'horaEntrada',
                'genero', 'especie', 'objeto', 'prioridade'
            ];
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                const errorElement = document.getElementById(field + 'Error');
                element.style.borderColor = '#ddd';
                errorElement.style.display = 'none';
            });
        }

        
        document.getElementById('secretaria').addEventListener('change', function() {
            const secretaria = this.value;
            const destinoInput = document.getElementById('destino');
            if (secretaria) {
                destinoInput.value = secretaria;
            } else {
                destinoInput.value = ''; 
            }
        });

        
        document.getElementById('numeroProcesso').addEventListener('change', async function() {
            const numeroProcesso = this.value.trim();
            if (numeroProcesso) {
                try {
                    const response = await fetch(`/get_process_by_number/${encodeURIComponent(numeroProcesso)}`);
                    if (response.ok) {
                        const data = await response.json();
                        
                        document.getElementById('volume').value = data.volume || '';
                        document.getElementById('secretaria').value = data.secretaria || '';
                        document.getElementById('dataEntrada').value = data.data_entrada || '';
                        document.getElementById('horaEntrada').value = data.hora_entrada || '';
                        document.getElementById('dataSaida').value = data.data_saida || '';
                        document.getElementById('horaSaida').value = data.hora_saida || '';
                        document.getElementById('destino').value = data.destino || '';
                        document.getElementById('genero').value = data.genero || '';
                        document.getElementById('especie').value = data.especie || '';
                        document.getElementById('objeto').value = data.objeto || '';
                        document.getElementById('contratada').value = data.contratada || '';
                        document.getElementById('recorrente').value = data.recorrente || 'NÃO'; 
                        document.getElementById('prioridade').value = data.prioridade || '';
                        document.getElementById('tecnico').value = data.tecnico || '';
                        document.getElementById('dataAnalise').value = data.data_analise || '';
                        document.getElementById('numeroDespacho').value = data.numero_despacho || '';
                        document.getElementById('observacao').value = data.observacao || '';

                        alert('Processo existente encontrado e formulário preenchido.');
                    } else if (response.status === 404) {
                        
                        limparFormularioParcial();
                    } else {
                        console.error('Error fetching process data:', response.statusText);
                        alert('Erro ao buscar dados do processo. Tente novamente.');
                    }
                } catch (error) {
                    console.error('Network error:', error);
                    alert('Erro de rede ao buscar dados do processo.');
                }
            } else {
                
                limparFormularioParcial();
            }
        });

        
        function limparFormularioParcial() {
            document.getElementById('volume').value = '';
            document.getElementById('secretaria').value = '';
            document.getElementById('dataEntrada').value = '';
            document.getElementById('horaEntrada').value = '';
            document.getElementById('dataSaida').value = '';
            document.getElementById('horaSaida').value = '';
            document.getElementById('destino').value = '';
            document.getElementById('genero').value = '';
            document.getElementById('especie').value = '';
            document.getElementById('objeto').value = '';
            document.getElementById('contratada').value = '';
            document.getElementById('recorrente').value = 'NÃO';
            document.getElementById('prioridade').value = '';
            document.getElementById('tecnico').value = '';
            document.getElementById('dataAnalise').value = '';
            document.getElementById('numeroDespacho').value = '';
            document.getElementById('observacao').value = '';
        }

    </script>
</body>
</html>